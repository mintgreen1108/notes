#对象实例化时PHP内存分配

对网上相关博客自己理解后的总结。

##内存构成

1、数据段：存放部分常量和全局变量。</br>
2、代码段：存放部分常量以及程序代码（如函数等），相比于数据段，代码段可执行，并且供多进程共享。</br>
3、栈段：存放函数参数和变量。当函数返回时，这些数据自动销毁。栈段——向下即低地址增长的，当push一个元素进栈时，栈顶指针向低地址移动。当pop一个元素时，栈顶指针向高地址移动。</br>
4、堆段：该部分的内存大小没有限制，完全由程序控制内存分配。包括内存的申请和内存的回收。</br>

##实例化

```js
class person{
   public $name;
   public $sex;
   public $age;
  
   public function eat($food){
   }
}
```

```js
   $p=new person();
```

上述为简单实例化对象的例子。首先实例化分成两个部分，由上文可知，具体实例化后的对象存放在堆中，然后在栈中申请一个空间，存放变量$p。而$p存放的便是对象在栈中存放的首地址，用来指向具体实例对象。问题来了，那实例化的对象在堆中是怎么存放的呢？

一个对象中包含成员变量，成员函数以及成员函数内部的变量和函数参数。结合博客和自己理解，我认为堆中只存放成员变量和指向成员函数的地址。而成员函数存放在代码段中，同时成员函数中的函数参数和临时变量由于是动态生成的，应当存放在栈中。当函数返回时，自动销毁。

具体逻辑图如图所示：
![](http://pic002.cnblogs.com/images/2011/290327/2011100611255611.jpg)
